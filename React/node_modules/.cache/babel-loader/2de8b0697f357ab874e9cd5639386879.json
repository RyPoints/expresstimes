{"ast":null,"code":"/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\n\"use strict\";\n\nvar EventEmitter = require(\"events\").EventEmitter;\n\nvar async = require(\"neo-async\");\n\nvar chokidar = require(\"chokidar\");\n\nvar fs = require(\"graceful-fs\");\n\nvar path = require(\"path\");\n\nvar watcherManager = require(\"./watcherManager\");\n\nvar FS_ACCURACY = 1000;\n\nfunction withoutCase(str) {\n  return str.toLowerCase();\n}\n\nfunction Watcher(directoryWatcher, filePath, startTime) {\n  EventEmitter.call(this);\n  this.directoryWatcher = directoryWatcher;\n  this.path = filePath;\n  this.startTime = startTime && +startTime; // TODO this.data seem to be only read, weird\n\n  this.data = 0;\n}\n\nWatcher.prototype = Object.create(EventEmitter.prototype);\nWatcher.prototype.constructor = Watcher;\n\nWatcher.prototype.checkStartTime = function checkStartTime(mtime, initial) {\n  if (typeof this.startTime !== \"number\") return !initial;\n  var startTime = this.startTime;\n  return startTime <= mtime;\n};\n\nWatcher.prototype.close = function close() {\n  this.emit(\"closed\");\n};\n\nfunction DirectoryWatcher(directoryPath, options) {\n  EventEmitter.call(this);\n  this.options = options;\n  this.path = directoryPath;\n  this.files = Object.create(null);\n  this.directories = Object.create(null);\n  var interval = typeof options.poll === \"number\" ? options.poll : undefined;\n  this.watcher = chokidar.watch(directoryPath, {\n    ignoreInitial: true,\n    persistent: true,\n    followSymlinks: false,\n    depth: 0,\n    atomic: false,\n    alwaysStat: true,\n    ignorePermissionErrors: true,\n    ignored: options.ignored,\n    usePolling: options.poll ? true : undefined,\n    interval: interval,\n    binaryInterval: interval,\n    disableGlobbing: true\n  });\n  this.watcher.on(\"add\", this.onFileAdded.bind(this));\n  this.watcher.on(\"addDir\", this.onDirectoryAdded.bind(this));\n  this.watcher.on(\"change\", this.onChange.bind(this));\n  this.watcher.on(\"unlink\", this.onFileUnlinked.bind(this));\n  this.watcher.on(\"unlinkDir\", this.onDirectoryUnlinked.bind(this));\n  this.watcher.on(\"error\", this.onWatcherError.bind(this));\n  this.initialScan = true;\n  this.nestedWatching = false;\n  this.initialScanRemoved = [];\n  this.doInitialScan();\n  this.watchers = Object.create(null);\n  this.parentWatcher = null;\n  this.refs = 0;\n}\n\nmodule.exports = DirectoryWatcher;\nDirectoryWatcher.prototype = Object.create(EventEmitter.prototype);\nDirectoryWatcher.prototype.constructor = DirectoryWatcher;\n\nDirectoryWatcher.prototype.setFileTime = function setFileTime(filePath, mtime, initial, type) {\n  var now = Date.now();\n  var old = this.files[filePath];\n  this.files[filePath] = [initial ? Math.min(now, mtime) : now, mtime]; // we add the fs accuracy to reach the maximum possible mtime\n\n  if (mtime) mtime = mtime + FS_ACCURACY;\n\n  if (!old) {\n    if (mtime) {\n      if (this.watchers[withoutCase(filePath)]) {\n        this.watchers[withoutCase(filePath)].forEach(function (w) {\n          if (!initial || w.checkStartTime(mtime, initial)) {\n            w.emit(\"change\", mtime, initial ? \"initial\" : type);\n          }\n        });\n      }\n    }\n  } else if (!initial && mtime) {\n    if (this.watchers[withoutCase(filePath)]) {\n      this.watchers[withoutCase(filePath)].forEach(function (w) {\n        w.emit(\"change\", mtime, type);\n      });\n    }\n  } else if (!initial && !mtime) {\n    if (this.watchers[withoutCase(filePath)]) {\n      this.watchers[withoutCase(filePath)].forEach(function (w) {\n        w.emit(\"remove\", type);\n      });\n    }\n  }\n\n  if (this.watchers[withoutCase(this.path)]) {\n    this.watchers[withoutCase(this.path)].forEach(function (w) {\n      if (!initial || w.checkStartTime(mtime, initial)) {\n        w.emit(\"change\", filePath, mtime, initial ? \"initial\" : type);\n      }\n    });\n  }\n};\n\nDirectoryWatcher.prototype.setDirectory = function setDirectory(directoryPath, exist, initial, type) {\n  if (directoryPath === this.path) {\n    if (!initial && this.watchers[withoutCase(this.path)]) {\n      this.watchers[withoutCase(this.path)].forEach(function (w) {\n        w.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\n      });\n    }\n  } else {\n    var old = this.directories[directoryPath];\n\n    if (!old) {\n      if (exist) {\n        if (this.nestedWatching) {\n          this.createNestedWatcher(directoryPath);\n        } else {\n          this.directories[directoryPath] = true;\n        }\n\n        if (!initial && this.watchers[withoutCase(this.path)]) {\n          this.watchers[withoutCase(this.path)].forEach(function (w) {\n            w.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\n          });\n        }\n\n        if (this.watchers[withoutCase(directoryPath) + \"#directory\"]) {\n          this.watchers[withoutCase(directoryPath) + \"#directory\"].forEach(function (w) {\n            w.emit(\"change\", w.data, initial ? \"initial\" : type);\n          });\n        }\n      }\n    } else {\n      if (!exist) {\n        if (this.nestedWatching) this.directories[directoryPath].close();\n        delete this.directories[directoryPath];\n\n        if (!initial && this.watchers[withoutCase(this.path)]) {\n          this.watchers[withoutCase(this.path)].forEach(function (w) {\n            w.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\n          });\n        }\n\n        if (this.watchers[withoutCase(directoryPath) + \"#directory\"]) {\n          this.watchers[withoutCase(directoryPath) + \"#directory\"].forEach(function (w) {\n            w.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\n          });\n        }\n      }\n    }\n  }\n};\n\nDirectoryWatcher.prototype.createNestedWatcher = function (directoryPath) {\n  this.directories[directoryPath] = watcherManager.watchDirectory(directoryPath, this.options, 1);\n  this.directories[directoryPath].on(\"change\", function (filePath, mtime, type) {\n    if (this.watchers[withoutCase(this.path)]) {\n      this.watchers[withoutCase(this.path)].forEach(function (w) {\n        if (w.checkStartTime(mtime, false)) {\n          w.emit(\"change\", filePath, mtime, type);\n        }\n      });\n    }\n  }.bind(this));\n};\n\nDirectoryWatcher.prototype.setNestedWatching = function (flag) {\n  if (this.nestedWatching !== !!flag) {\n    this.nestedWatching = !!flag;\n\n    if (this.nestedWatching) {\n      Object.keys(this.directories).forEach(function (directory) {\n        this.createNestedWatcher(directory);\n      }, this);\n    } else {\n      Object.keys(this.directories).forEach(function (directory) {\n        this.directories[directory].close();\n        this.directories[directory] = true;\n      }, this);\n    }\n  }\n};\n\nDirectoryWatcher.prototype.watch = function watch(filePath, startTime) {\n  this.watchers[withoutCase(filePath)] = this.watchers[withoutCase(filePath)] || [];\n  this.refs++;\n  var watcher = new Watcher(this, filePath, startTime);\n  watcher.on(\"closed\", function () {\n    var idx = this.watchers[withoutCase(filePath)].indexOf(watcher);\n    this.watchers[withoutCase(filePath)].splice(idx, 1);\n\n    if (this.watchers[withoutCase(filePath)].length === 0) {\n      delete this.watchers[withoutCase(filePath)];\n      if (this.path === filePath) this.setNestedWatching(false);\n    }\n\n    if (--this.refs <= 0) this.close();\n  }.bind(this));\n  this.watchers[withoutCase(filePath)].push(watcher);\n  var data;\n\n  if (filePath === this.path) {\n    this.setNestedWatching(true);\n    data = false;\n    Object.keys(this.files).forEach(function (file) {\n      var d = this.files[file];\n      if (!data) data = d;else data = [Math.max(data[0], d[0]), Math.max(data[1], d[1])];\n    }, this);\n  } else {\n    data = this.files[filePath];\n  }\n\n  process.nextTick(function () {\n    if (data) {\n      var ts = data[0] === data[1] ? data[0] + FS_ACCURACY : data[0];\n      if (ts >= startTime) watcher.emit(\"change\", data[1]);\n    } else if (this.initialScan && this.initialScanRemoved.indexOf(filePath) >= 0) {\n      watcher.emit(\"remove\");\n    }\n  }.bind(this));\n  return watcher;\n};\n\nDirectoryWatcher.prototype.onFileAdded = function onFileAdded(filePath, stat) {\n  if (filePath.indexOf(this.path) !== 0) return;\n  if (/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\n  this.setFileTime(filePath, +stat.mtime || +stat.ctime || 1, false, \"add\");\n};\n\nDirectoryWatcher.prototype.onDirectoryAdded = function onDirectoryAdded(directoryPath\n/*, stat */\n) {\n  if (directoryPath.indexOf(this.path) !== 0) return;\n  if (/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\n  this.setDirectory(directoryPath, true, false, \"add\");\n};\n\nDirectoryWatcher.prototype.onChange = function onChange(filePath, stat) {\n  if (filePath.indexOf(this.path) !== 0) return;\n  if (/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\n  var mtime = +stat.mtime || +stat.ctime || 1;\n  ensureFsAccuracy(mtime);\n  this.setFileTime(filePath, mtime, false, \"change\");\n};\n\nDirectoryWatcher.prototype.onFileUnlinked = function onFileUnlinked(filePath) {\n  if (filePath.indexOf(this.path) !== 0) return;\n  if (/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\n  this.setFileTime(filePath, null, false, \"unlink\");\n\n  if (this.initialScan) {\n    this.initialScanRemoved.push(filePath);\n  }\n};\n\nDirectoryWatcher.prototype.onDirectoryUnlinked = function onDirectoryUnlinked(directoryPath) {\n  if (directoryPath.indexOf(this.path) !== 0) return;\n  if (/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\n  this.setDirectory(directoryPath, false, false, \"unlink\");\n\n  if (this.initialScan) {\n    this.initialScanRemoved.push(directoryPath);\n  }\n};\n\nDirectoryWatcher.prototype.onWatcherError = function onWatcherError()\n/* err */\n{};\n\nDirectoryWatcher.prototype.doInitialScan = function doInitialScan() {\n  fs.readdir(this.path, function (err, items) {\n    if (err) {\n      this.parentWatcher = watcherManager.watchFile(this.path + \"#directory\", this.options, 1);\n      this.parentWatcher.on(\"change\", function (mtime, type) {\n        if (this.watchers[withoutCase(this.path)]) {\n          this.watchers[withoutCase(this.path)].forEach(function (w) {\n            w.emit(\"change\", this.path, mtime, type);\n          }, this);\n        }\n      }.bind(this));\n      this.initialScan = false;\n      return;\n    }\n\n    async.forEach(items, function (item, callback) {\n      var itemPath = path.join(this.path, item);\n      fs.stat(itemPath, function (err2, stat) {\n        if (!this.initialScan) return;\n\n        if (err2) {\n          callback();\n          return;\n        }\n\n        if (stat.isFile()) {\n          if (!this.files[itemPath]) this.setFileTime(itemPath, +stat.mtime || +stat.ctime || 1, true);\n        } else if (stat.isDirectory()) {\n          if (!this.directories[itemPath]) this.setDirectory(itemPath, true, true);\n        }\n\n        callback();\n      }.bind(this));\n    }.bind(this), function () {\n      this.initialScan = false;\n      this.initialScanRemoved = null;\n    }.bind(this));\n  }.bind(this));\n};\n\nDirectoryWatcher.prototype.getTimes = function () {\n  var obj = Object.create(null);\n  var selfTime = 0;\n  Object.keys(this.files).forEach(function (file) {\n    var data = this.files[file];\n    var time;\n\n    if (data[1]) {\n      time = Math.max(data[0], data[1] + FS_ACCURACY);\n    } else {\n      time = data[0];\n    }\n\n    obj[file] = time;\n    if (time > selfTime) selfTime = time;\n  }, this);\n\n  if (this.nestedWatching) {\n    Object.keys(this.directories).forEach(function (dir) {\n      var w = this.directories[dir];\n      var times = w.directoryWatcher.getTimes();\n      Object.keys(times).forEach(function (file) {\n        var time = times[file];\n        obj[file] = time;\n        if (time > selfTime) selfTime = time;\n      });\n    }, this);\n    obj[this.path] = selfTime;\n  }\n\n  return obj;\n};\n\nDirectoryWatcher.prototype.close = function () {\n  this.initialScan = false;\n  this.watcher.close();\n\n  if (this.nestedWatching) {\n    Object.keys(this.directories).forEach(function (dir) {\n      this.directories[dir].close();\n    }, this);\n  }\n\n  if (this.parentWatcher) this.parentWatcher.close();\n  this.emit(\"closed\");\n};\n\nfunction ensureFsAccuracy(mtime) {\n  if (!mtime) return;\n  if (FS_ACCURACY > 1 && mtime % 1 !== 0) FS_ACCURACY = 1;else if (FS_ACCURACY > 10 && mtime % 10 !== 0) FS_ACCURACY = 10;else if (FS_ACCURACY > 100 && mtime % 100 !== 0) FS_ACCURACY = 100;\n}","map":{"version":3,"sources":["/Users/ryandavis/Development/reactapp/expresstimes/node_modules/watchpack/lib/DirectoryWatcher.js"],"names":["EventEmitter","require","async","chokidar","fs","path","watcherManager","FS_ACCURACY","withoutCase","str","toLowerCase","Watcher","directoryWatcher","filePath","startTime","call","data","prototype","Object","create","constructor","checkStartTime","mtime","initial","close","emit","DirectoryWatcher","directoryPath","options","files","directories","interval","poll","undefined","watcher","watch","ignoreInitial","persistent","followSymlinks","depth","atomic","alwaysStat","ignorePermissionErrors","ignored","usePolling","binaryInterval","disableGlobbing","on","onFileAdded","bind","onDirectoryAdded","onChange","onFileUnlinked","onDirectoryUnlinked","onWatcherError","initialScan","nestedWatching","initialScanRemoved","doInitialScan","watchers","parentWatcher","refs","module","exports","setFileTime","type","now","Date","old","Math","min","forEach","w","setDirectory","exist","createNestedWatcher","watchDirectory","setNestedWatching","flag","keys","directory","idx","indexOf","splice","length","push","file","d","max","process","nextTick","ts","stat","test","substr","ctime","ensureFsAccuracy","readdir","err","items","watchFile","item","callback","itemPath","join","err2","isFile","isDirectory","getTimes","obj","selfTime","time","dir","times"],"mappings":"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","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\n\"use strict\";\r\n\r\nvar EventEmitter = require(\"events\").EventEmitter;\r\nvar async = require(\"neo-async\");\r\nvar chokidar = require(\"chokidar\");\r\nvar fs = require(\"graceful-fs\");\r\nvar path = require(\"path\");\r\n\r\nvar watcherManager = require(\"./watcherManager\");\r\n\r\nvar FS_ACCURACY = 1000;\r\n\r\n\r\nfunction withoutCase(str) {\r\n\treturn str.toLowerCase();\r\n}\r\n\r\n\r\nfunction Watcher(directoryWatcher, filePath, startTime) {\r\n\tEventEmitter.call(this);\r\n\tthis.directoryWatcher = directoryWatcher;\r\n\tthis.path = filePath;\r\n\tthis.startTime = startTime && +startTime;\r\n\t// TODO this.data seem to be only read, weird\r\n\tthis.data = 0;\r\n}\r\n\r\nWatcher.prototype = Object.create(EventEmitter.prototype);\r\nWatcher.prototype.constructor = Watcher;\r\n\r\nWatcher.prototype.checkStartTime = function checkStartTime(mtime, initial) {\r\n\tif(typeof this.startTime !== \"number\") return !initial;\r\n\tvar startTime = this.startTime;\r\n\treturn startTime <= mtime;\r\n};\r\n\r\nWatcher.prototype.close = function close() {\r\n\tthis.emit(\"closed\");\r\n};\r\n\r\n\r\nfunction DirectoryWatcher(directoryPath, options) {\r\n\tEventEmitter.call(this);\r\n\tthis.options = options;\r\n\tthis.path = directoryPath;\r\n\tthis.files = Object.create(null);\r\n\tthis.directories = Object.create(null);\r\n\tvar interval = typeof options.poll === \"number\" ? options.poll : undefined;\r\n\tthis.watcher = chokidar.watch(directoryPath, {\r\n\t\tignoreInitial: true,\r\n\t\tpersistent: true,\r\n\t\tfollowSymlinks: false,\r\n\t\tdepth: 0,\r\n\t\tatomic: false,\r\n\t\talwaysStat: true,\r\n\t\tignorePermissionErrors: true,\r\n\t\tignored: options.ignored,\r\n\t\tusePolling: options.poll ? true : undefined,\r\n\t\tinterval: interval,\r\n\t\tbinaryInterval: interval,\r\n\t\tdisableGlobbing: true\r\n\t});\r\n\tthis.watcher.on(\"add\", this.onFileAdded.bind(this));\r\n\tthis.watcher.on(\"addDir\", this.onDirectoryAdded.bind(this));\r\n\tthis.watcher.on(\"change\", this.onChange.bind(this));\r\n\tthis.watcher.on(\"unlink\", this.onFileUnlinked.bind(this));\r\n\tthis.watcher.on(\"unlinkDir\", this.onDirectoryUnlinked.bind(this));\r\n\tthis.watcher.on(\"error\", this.onWatcherError.bind(this));\r\n\tthis.initialScan = true;\r\n\tthis.nestedWatching = false;\r\n\tthis.initialScanRemoved = [];\r\n\tthis.doInitialScan();\r\n\tthis.watchers = Object.create(null);\r\n\tthis.parentWatcher = null;\r\n\tthis.refs = 0;\r\n}\r\nmodule.exports = DirectoryWatcher;\r\n\r\nDirectoryWatcher.prototype = Object.create(EventEmitter.prototype);\r\nDirectoryWatcher.prototype.constructor = DirectoryWatcher;\r\n\r\nDirectoryWatcher.prototype.setFileTime = function setFileTime(filePath, mtime, initial, type) {\r\n\tvar now = Date.now();\r\n\tvar old = this.files[filePath];\r\n\r\n\tthis.files[filePath] = [initial ? Math.min(now, mtime) : now, mtime];\r\n\r\n\t// we add the fs accuracy to reach the maximum possible mtime\r\n\tif(mtime)\r\n\t\tmtime = mtime + FS_ACCURACY;\r\n\r\n\tif(!old) {\r\n\t\tif(mtime) {\r\n\t\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\t\tif(!initial || w.checkStartTime(mtime, initial)) {\r\n\t\t\t\t\t\tw.emit(\"change\", mtime, initial ? \"initial\" : type);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t} else if(!initial && mtime) {\r\n\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\tw.emit(\"change\", mtime, type);\r\n\t\t\t});\r\n\t\t}\r\n\t} else if(!initial && !mtime) {\r\n\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\tw.emit(\"remove\", type);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tif(this.watchers[withoutCase(this.path)]) {\r\n\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\tif(!initial || w.checkStartTime(mtime, initial)) {\r\n\t\t\t\tw.emit(\"change\", filePath, mtime, initial ? \"initial\" : type);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.setDirectory = function setDirectory(directoryPath, exist, initial, type) {\r\n\tif(directoryPath === this.path) {\r\n\t\tif(!initial && this.watchers[withoutCase(this.path)]) {\r\n\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\tw.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\r\n\t\t\t});\r\n\t\t}\r\n\t} else {\r\n\t\tvar old = this.directories[directoryPath];\r\n\t\tif(!old) {\r\n\t\t\tif(exist) {\r\n\t\t\t\tif(this.nestedWatching) {\r\n\t\t\t\t\tthis.createNestedWatcher(directoryPath);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.directories[directoryPath] = true;\r\n\t\t\t\t}\r\n\t\t\t\tif(!initial && this.watchers[withoutCase(this.path)]) {\r\n\t\t\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\t\t\tw.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(this.watchers[withoutCase(directoryPath) + \"#directory\"]) {\r\n\t\t\t\t\tthis.watchers[withoutCase(directoryPath) + \"#directory\"].forEach(function(w) {\r\n\t\t\t\t\t\tw.emit(\"change\", w.data, initial ? \"initial\" : type);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif(!exist) {\r\n\t\t\t\tif(this.nestedWatching)\r\n\t\t\t\t\tthis.directories[directoryPath].close();\r\n\t\t\t\tdelete this.directories[directoryPath];\r\n\t\t\t\tif(!initial && this.watchers[withoutCase(this.path)]) {\r\n\t\t\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\t\t\tw.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(this.watchers[withoutCase(directoryPath) + \"#directory\"]) {\r\n\t\t\t\t\tthis.watchers[withoutCase(directoryPath) + \"#directory\"].forEach(function(w) {\r\n\t\t\t\t\t\tw.emit(\"change\", directoryPath, w.data, initial ? \"initial\" : type);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.createNestedWatcher = function(directoryPath) {\r\n\tthis.directories[directoryPath] = watcherManager.watchDirectory(directoryPath, this.options, 1);\r\n\tthis.directories[directoryPath].on(\"change\", function(filePath, mtime, type) {\r\n\t\tif(this.watchers[withoutCase(this.path)]) {\r\n\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\tif(w.checkStartTime(mtime, false)) {\r\n\t\t\t\t\tw.emit(\"change\", filePath, mtime, type);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}.bind(this));\r\n};\r\n\r\nDirectoryWatcher.prototype.setNestedWatching = function(flag) {\r\n\tif(this.nestedWatching !== !!flag) {\r\n\t\tthis.nestedWatching = !!flag;\r\n\t\tif(this.nestedWatching) {\r\n\t\t\tObject.keys(this.directories).forEach(function(directory) {\r\n\t\t\t\tthis.createNestedWatcher(directory);\r\n\t\t\t}, this);\r\n\t\t} else {\r\n\t\t\tObject.keys(this.directories).forEach(function(directory) {\r\n\t\t\t\tthis.directories[directory].close();\r\n\t\t\t\tthis.directories[directory] = true;\r\n\t\t\t}, this);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.watch = function watch(filePath, startTime) {\r\n\tthis.watchers[withoutCase(filePath)] = this.watchers[withoutCase(filePath)] || [];\r\n\tthis.refs++;\r\n\tvar watcher = new Watcher(this, filePath, startTime);\r\n\twatcher.on(\"closed\", function() {\r\n\t\tvar idx = this.watchers[withoutCase(filePath)].indexOf(watcher);\r\n\t\tthis.watchers[withoutCase(filePath)].splice(idx, 1);\r\n\t\tif(this.watchers[withoutCase(filePath)].length === 0) {\r\n\t\t\tdelete this.watchers[withoutCase(filePath)];\r\n\t\t\tif(this.path === filePath)\r\n\t\t\t\tthis.setNestedWatching(false);\r\n\t\t}\r\n\t\tif(--this.refs <= 0)\r\n\t\t\tthis.close();\r\n\t}.bind(this));\r\n\tthis.watchers[withoutCase(filePath)].push(watcher);\r\n\tvar data;\r\n\tif(filePath === this.path) {\r\n\t\tthis.setNestedWatching(true);\r\n\t\tdata = false;\r\n\t\tObject.keys(this.files).forEach(function(file) {\r\n\t\t\tvar d = this.files[file];\r\n\t\t\tif(!data)\r\n\t\t\t\tdata = d;\r\n\t\t\telse\r\n\t\t\t\tdata = [Math.max(data[0], d[0]), Math.max(data[1], d[1])];\r\n\t\t}, this);\r\n\t} else {\r\n\t\tdata = this.files[filePath];\r\n\t}\r\n\tprocess.nextTick(function() {\r\n\t\tif(data) {\r\n\t\t\tvar ts = data[0] === data[1] ? data[0] + FS_ACCURACY : data[0];\r\n\t\t\tif(ts >= startTime)\r\n\t\t\t\twatcher.emit(\"change\", data[1]);\r\n\t\t} else if(this.initialScan && this.initialScanRemoved.indexOf(filePath) >= 0) {\r\n\t\t\twatcher.emit(\"remove\");\r\n\t\t}\r\n\t}.bind(this));\r\n\treturn watcher;\r\n};\r\n\r\nDirectoryWatcher.prototype.onFileAdded = function onFileAdded(filePath, stat) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\r\n\tthis.setFileTime(filePath, +stat.mtime || +stat.ctime || 1, false, \"add\");\r\n};\r\n\r\nDirectoryWatcher.prototype.onDirectoryAdded = function onDirectoryAdded(directoryPath /*, stat */) {\r\n\tif(directoryPath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\r\n\tthis.setDirectory(directoryPath, true, false, \"add\");\r\n};\r\n\r\nDirectoryWatcher.prototype.onChange = function onChange(filePath, stat) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\tvar mtime = +stat.mtime || +stat.ctime || 1;\r\n\tensureFsAccuracy(mtime);\r\n\tthis.setFileTime(filePath, mtime, false, \"change\");\r\n};\r\n\r\nDirectoryWatcher.prototype.onFileUnlinked = function onFileUnlinked(filePath) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\tthis.setFileTime(filePath, null, false, \"unlink\");\r\n\tif(this.initialScan) {\r\n\t\tthis.initialScanRemoved.push(filePath);\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.onDirectoryUnlinked = function onDirectoryUnlinked(directoryPath) {\r\n\tif(directoryPath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\r\n\tthis.setDirectory(directoryPath, false, false, \"unlink\");\r\n\tif(this.initialScan) {\r\n\t\tthis.initialScanRemoved.push(directoryPath);\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.onWatcherError = function onWatcherError(/* err */) {\r\n};\r\n\r\nDirectoryWatcher.prototype.doInitialScan = function doInitialScan() {\r\n\tfs.readdir(this.path, function(err, items) {\r\n\t\tif(err) {\r\n\t\t\tthis.parentWatcher = watcherManager.watchFile(this.path + \"#directory\", this.options, 1);\r\n\t\t\tthis.parentWatcher.on(\"change\", function(mtime, type) {\r\n\t\t\t\tif(this.watchers[withoutCase(this.path)]) {\r\n\t\t\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\t\t\tw.emit(\"change\", this.path, mtime, type);\r\n\t\t\t\t\t}, this);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t\tthis.initialScan = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tasync.forEach(items, function(item, callback) {\r\n\t\t\tvar itemPath = path.join(this.path, item);\r\n\t\t\tfs.stat(itemPath, function(err2, stat) {\r\n\t\t\t\tif(!this.initialScan) return;\r\n\t\t\t\tif(err2) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(stat.isFile()) {\r\n\t\t\t\t\tif(!this.files[itemPath])\r\n\t\t\t\t\t\tthis.setFileTime(itemPath, +stat.mtime || +stat.ctime || 1, true);\r\n\t\t\t\t} else if(stat.isDirectory()) {\r\n\t\t\t\t\tif(!this.directories[itemPath])\r\n\t\t\t\t\t\tthis.setDirectory(itemPath, true, true);\r\n\t\t\t\t}\r\n\t\t\t\tcallback();\r\n\t\t\t}.bind(this));\r\n\t\t}.bind(this), function() {\r\n\t\t\tthis.initialScan = false;\r\n\t\t\tthis.initialScanRemoved = null;\r\n\t\t}.bind(this));\r\n\t}.bind(this));\r\n};\r\n\r\nDirectoryWatcher.prototype.getTimes = function() {\r\n\tvar obj = Object.create(null);\r\n\tvar selfTime = 0;\r\n\tObject.keys(this.files).forEach(function(file) {\r\n\t\tvar data = this.files[file];\r\n\t\tvar time;\r\n\t\tif(data[1]) {\r\n\t\t\ttime = Math.max(data[0], data[1] + FS_ACCURACY);\r\n\t\t} else {\r\n\t\t\ttime = data[0];\r\n\t\t}\r\n\t\tobj[file] = time;\r\n\t\tif(time > selfTime)\r\n\t\t\tselfTime = time;\r\n\t}, this);\r\n\tif(this.nestedWatching) {\r\n\t\tObject.keys(this.directories).forEach(function(dir) {\r\n\t\t\tvar w = this.directories[dir];\r\n\t\t\tvar times = w.directoryWatcher.getTimes();\r\n\t\t\tObject.keys(times).forEach(function(file) {\r\n\t\t\t\tvar time = times[file];\r\n\t\t\t\tobj[file] = time;\r\n\t\t\t\tif(time > selfTime)\r\n\t\t\t\t\tselfTime = time;\r\n\t\t\t});\r\n\t\t}, this);\r\n\t\tobj[this.path] = selfTime;\r\n\t}\r\n\treturn obj;\r\n};\r\n\r\nDirectoryWatcher.prototype.close = function() {\r\n\tthis.initialScan = false;\r\n\tthis.watcher.close();\r\n\tif(this.nestedWatching) {\r\n\t\tObject.keys(this.directories).forEach(function(dir) {\r\n\t\t\tthis.directories[dir].close();\r\n\t\t}, this);\r\n\t}\r\n\tif(this.parentWatcher) this.parentWatcher.close();\r\n\tthis.emit(\"closed\");\r\n};\r\n\r\nfunction ensureFsAccuracy(mtime) {\r\n\tif(!mtime) return;\r\n\tif(FS_ACCURACY > 1 && mtime % 1 !== 0)\r\n\t\tFS_ACCURACY = 1;\r\n\telse if(FS_ACCURACY > 10 && mtime % 10 !== 0)\r\n\t\tFS_ACCURACY = 10;\r\n\telse if(FS_ACCURACY > 100 && mtime % 100 !== 0)\r\n\t\tFS_ACCURACY = 100;\r\n}\r\n"]},"metadata":{},"sourceType":"script"}