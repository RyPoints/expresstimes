{"ast":null,"code":"module.exports = Polygon;\n\nvar util = require('util');\n\nvar Geometry = require('./geometry');\n\nvar Types = require('./types');\n\nvar Point = require('./point');\n\nvar BinaryWriter = require('./binarywriter');\n\nfunction Polygon(exteriorRing, interiorRings, srid) {\n  Geometry.call(this);\n  this.exteriorRing = exteriorRing || [];\n  this.interiorRings = interiorRings || [];\n  this.srid = srid;\n\n  if (this.exteriorRing.length > 0) {\n    this.hasZ = this.exteriorRing[0].hasZ;\n    this.hasM = this.exteriorRing[0].hasM;\n  }\n}\n\nutil.inherits(Polygon, Geometry);\n\nPolygon.Z = function (exteriorRing, interiorRings, srid) {\n  var polygon = new Polygon(exteriorRing, interiorRings, srid);\n  polygon.hasZ = true;\n  return polygon;\n};\n\nPolygon.M = function (exteriorRing, interiorRings, srid) {\n  var polygon = new Polygon(exteriorRing, interiorRings, srid);\n  polygon.hasM = true;\n  return polygon;\n};\n\nPolygon.ZM = function (exteriorRing, interiorRings, srid) {\n  var polygon = new Polygon(exteriorRing, interiorRings, srid);\n  polygon.hasZ = true;\n  polygon.hasM = true;\n  return polygon;\n};\n\nPolygon._parseWkt = function (value, options) {\n  var polygon = new Polygon();\n  polygon.srid = options.srid;\n  polygon.hasZ = options.hasZ;\n  polygon.hasM = options.hasM;\n  if (value.isMatch(['EMPTY'])) return polygon;\n  value.expectGroupStart();\n  value.expectGroupStart();\n  polygon.exteriorRing.push.apply(polygon.exteriorRing, value.matchCoordinates(options));\n  value.expectGroupEnd();\n\n  while (value.isMatch([','])) {\n    value.expectGroupStart();\n    polygon.interiorRings.push(value.matchCoordinates(options));\n    value.expectGroupEnd();\n  }\n\n  value.expectGroupEnd();\n  return polygon;\n};\n\nPolygon._parseWkb = function (value, options) {\n  var polygon = new Polygon();\n  polygon.srid = options.srid;\n  polygon.hasZ = options.hasZ;\n  polygon.hasM = options.hasM;\n  var ringCount = value.readUInt32();\n\n  if (ringCount > 0) {\n    var exteriorRingCount = value.readUInt32();\n\n    for (var i = 0; i < exteriorRingCount; i++) polygon.exteriorRing.push(Point._readWkbPoint(value, options));\n\n    for (i = 1; i < ringCount; i++) {\n      var interiorRing = [];\n      var interiorRingCount = value.readUInt32();\n\n      for (var j = 0; j < interiorRingCount; j++) interiorRing.push(Point._readWkbPoint(value, options));\n\n      polygon.interiorRings.push(interiorRing);\n    }\n  }\n\n  return polygon;\n};\n\nPolygon._parseTwkb = function (value, options) {\n  var polygon = new Polygon();\n  polygon.hasZ = options.hasZ;\n  polygon.hasM = options.hasM;\n  if (options.isEmpty) return polygon;\n  var previousPoint = new Point(0, 0, options.hasZ ? 0 : undefined, options.hasM ? 0 : undefined);\n  var ringCount = value.readVarInt();\n  var exteriorRingCount = value.readVarInt();\n\n  for (var i = 0; i < exteriorRingCount; i++) polygon.exteriorRing.push(Point._readTwkbPoint(value, options, previousPoint));\n\n  for (i = 1; i < ringCount; i++) {\n    var interiorRing = [];\n    var interiorRingCount = value.readVarInt();\n\n    for (var j = 0; j < interiorRingCount; j++) interiorRing.push(Point._readTwkbPoint(value, options, previousPoint));\n\n    polygon.interiorRings.push(interiorRing);\n  }\n\n  return polygon;\n};\n\nPolygon._parseGeoJSON = function (value) {\n  var polygon = new Polygon();\n  if (value.coordinates.length > 0 && value.coordinates[0].length > 0) polygon.hasZ = value.coordinates[0][0].length > 2;\n\n  for (var i = 0; i < value.coordinates.length; i++) {\n    if (i > 0) polygon.interiorRings.push([]);\n\n    for (var j = 0; j < value.coordinates[i].length; j++) {\n      if (i === 0) polygon.exteriorRing.push(Point._readGeoJSONPoint(value.coordinates[i][j]));else polygon.interiorRings[i - 1].push(Point._readGeoJSONPoint(value.coordinates[i][j]));\n    }\n  }\n\n  return polygon;\n};\n\nPolygon.prototype.toWkt = function () {\n  if (this.exteriorRing.length === 0) return this._getWktType(Types.wkt.Polygon, true);\n  return this._getWktType(Types.wkt.Polygon, false) + this._toInnerWkt();\n};\n\nPolygon.prototype._toInnerWkt = function () {\n  var innerWkt = '((';\n\n  for (var i = 0; i < this.exteriorRing.length; i++) innerWkt += this._getWktCoordinate(this.exteriorRing[i]) + ',';\n\n  innerWkt = innerWkt.slice(0, -1);\n  innerWkt += ')';\n\n  for (i = 0; i < this.interiorRings.length; i++) {\n    innerWkt += ',(';\n\n    for (var j = 0; j < this.interiorRings[i].length; j++) {\n      innerWkt += this._getWktCoordinate(this.interiorRings[i][j]) + ',';\n    }\n\n    innerWkt = innerWkt.slice(0, -1);\n    innerWkt += ')';\n  }\n\n  innerWkt += ')';\n  return innerWkt;\n};\n\nPolygon.prototype.toWkb = function (parentOptions) {\n  var wkb = new BinaryWriter(this._getWkbSize());\n  wkb.writeInt8(1);\n\n  this._writeWkbType(wkb, Types.wkb.Polygon, parentOptions);\n\n  if (this.exteriorRing.length > 0) {\n    wkb.writeUInt32LE(1 + this.interiorRings.length);\n    wkb.writeUInt32LE(this.exteriorRing.length);\n  } else {\n    wkb.writeUInt32LE(0);\n  }\n\n  for (var i = 0; i < this.exteriorRing.length; i++) this.exteriorRing[i]._writeWkbPoint(wkb);\n\n  for (i = 0; i < this.interiorRings.length; i++) {\n    wkb.writeUInt32LE(this.interiorRings[i].length);\n\n    for (var j = 0; j < this.interiorRings[i].length; j++) this.interiorRings[i][j]._writeWkbPoint(wkb);\n  }\n\n  return wkb.buffer;\n};\n\nPolygon.prototype.toTwkb = function () {\n  var twkb = new BinaryWriter(0, true);\n  var precision = Geometry.getTwkbPrecision(5, 0, 0);\n  var isEmpty = this.exteriorRing.length === 0;\n\n  this._writeTwkbHeader(twkb, Types.wkb.Polygon, precision, isEmpty);\n\n  if (this.exteriorRing.length > 0) {\n    twkb.writeVarInt(1 + this.interiorRings.length);\n    twkb.writeVarInt(this.exteriorRing.length);\n    var previousPoint = new Point(0, 0, 0, 0);\n\n    for (var i = 0; i < this.exteriorRing.length; i++) this.exteriorRing[i]._writeTwkbPoint(twkb, precision, previousPoint);\n\n    for (i = 0; i < this.interiorRings.length; i++) {\n      twkb.writeVarInt(this.interiorRings[i].length);\n\n      for (var j = 0; j < this.interiorRings[i].length; j++) this.interiorRings[i][j]._writeTwkbPoint(twkb, precision, previousPoint);\n    }\n  }\n\n  return twkb.buffer;\n};\n\nPolygon.prototype._getWkbSize = function () {\n  var coordinateSize = 16;\n  if (this.hasZ) coordinateSize += 8;\n  if (this.hasM) coordinateSize += 8;\n  var size = 1 + 4 + 4;\n  if (this.exteriorRing.length > 0) size += 4 + this.exteriorRing.length * coordinateSize;\n\n  for (var i = 0; i < this.interiorRings.length; i++) size += 4 + this.interiorRings[i].length * coordinateSize;\n\n  return size;\n};\n\nPolygon.prototype.toGeoJSON = function (options) {\n  var geoJSON = Geometry.prototype.toGeoJSON.call(this, options);\n  geoJSON.type = Types.geoJSON.Polygon;\n  geoJSON.coordinates = [];\n\n  if (this.exteriorRing.length > 0) {\n    var exteriorRing = [];\n\n    for (var i = 0; i < this.exteriorRing.length; i++) {\n      if (this.hasZ) exteriorRing.push([this.exteriorRing[i].x, this.exteriorRing[i].y, this.exteriorRing[i].z]);else exteriorRing.push([this.exteriorRing[i].x, this.exteriorRing[i].y]);\n    }\n\n    geoJSON.coordinates.push(exteriorRing);\n  }\n\n  for (var j = 0; j < this.interiorRings.length; j++) {\n    var interiorRing = [];\n\n    for (var k = 0; k < this.interiorRings[j].length; k++) {\n      if (this.hasZ) interiorRing.push([this.interiorRings[j][k].x, this.interiorRings[j][k].y, this.interiorRings[j][k].z]);else interiorRing.push([this.interiorRings[j][k].x, this.interiorRings[j][k].y]);\n    }\n\n    geoJSON.coordinates.push(interiorRing);\n  }\n\n  return geoJSON;\n};","map":{"version":3,"sources":["/Users/ryandavis/Development/reactapp/expresstimes/node_modules/wkx/lib/polygon.js"],"names":["module","exports","Polygon","util","require","Geometry","Types","Point","BinaryWriter","exteriorRing","interiorRings","srid","call","length","hasZ","hasM","inherits","Z","polygon","M","ZM","_parseWkt","value","options","isMatch","expectGroupStart","push","apply","matchCoordinates","expectGroupEnd","_parseWkb","ringCount","readUInt32","exteriorRingCount","i","_readWkbPoint","interiorRing","interiorRingCount","j","_parseTwkb","isEmpty","previousPoint","undefined","readVarInt","_readTwkbPoint","_parseGeoJSON","coordinates","_readGeoJSONPoint","prototype","toWkt","_getWktType","wkt","_toInnerWkt","innerWkt","_getWktCoordinate","slice","toWkb","parentOptions","wkb","_getWkbSize","writeInt8","_writeWkbType","writeUInt32LE","_writeWkbPoint","buffer","toTwkb","twkb","precision","getTwkbPrecision","_writeTwkbHeader","writeVarInt","_writeTwkbPoint","coordinateSize","size","toGeoJSON","geoJSON","type","x","y","z","k"],"mappings":"AAAAA,MAAM,CAACC,OAAP,GAAiBC,OAAjB;;AAEA,IAAIC,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;;AAEA,IAAIC,QAAQ,GAAGD,OAAO,CAAC,YAAD,CAAtB;;AACA,IAAIE,KAAK,GAAGF,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAIG,KAAK,GAAGH,OAAO,CAAC,SAAD,CAAnB;;AACA,IAAII,YAAY,GAAGJ,OAAO,CAAC,gBAAD,CAA1B;;AAEA,SAASF,OAAT,CAAiBO,YAAjB,EAA+BC,aAA/B,EAA8CC,IAA9C,EAAoD;AAChDN,EAAAA,QAAQ,CAACO,IAAT,CAAc,IAAd;AAEA,OAAKH,YAAL,GAAoBA,YAAY,IAAI,EAApC;AACA,OAAKC,aAAL,GAAqBA,aAAa,IAAI,EAAtC;AACH,OAAKC,IAAL,GAAYA,IAAZ;;AAEG,MAAI,KAAKF,YAAL,CAAkBI,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B,SAAKC,IAAL,GAAY,KAAKL,YAAL,CAAkB,CAAlB,EAAqBK,IAAjC;AACA,SAAKC,IAAL,GAAY,KAAKN,YAAL,CAAkB,CAAlB,EAAqBM,IAAjC;AACH;AACJ;;AAEDZ,IAAI,CAACa,QAAL,CAAcd,OAAd,EAAuBG,QAAvB;;AAEAH,OAAO,CAACe,CAAR,GAAY,UAAUR,YAAV,EAAwBC,aAAxB,EAAuCC,IAAvC,EAA6C;AACrD,MAAIO,OAAO,GAAG,IAAIhB,OAAJ,CAAYO,YAAZ,EAA0BC,aAA1B,EAAyCC,IAAzC,CAAd;AACAO,EAAAA,OAAO,CAACJ,IAAR,GAAe,IAAf;AACA,SAAOI,OAAP;AACH,CAJD;;AAMAhB,OAAO,CAACiB,CAAR,GAAY,UAAUV,YAAV,EAAwBC,aAAxB,EAAuCC,IAAvC,EAA6C;AACrD,MAAIO,OAAO,GAAG,IAAIhB,OAAJ,CAAYO,YAAZ,EAA0BC,aAA1B,EAAyCC,IAAzC,CAAd;AACAO,EAAAA,OAAO,CAACH,IAAR,GAAe,IAAf;AACA,SAAOG,OAAP;AACH,CAJD;;AAMAhB,OAAO,CAACkB,EAAR,GAAa,UAAUX,YAAV,EAAwBC,aAAxB,EAAuCC,IAAvC,EAA6C;AACtD,MAAIO,OAAO,GAAG,IAAIhB,OAAJ,CAAYO,YAAZ,EAA0BC,aAA1B,EAAyCC,IAAzC,CAAd;AACAO,EAAAA,OAAO,CAACJ,IAAR,GAAe,IAAf;AACAI,EAAAA,OAAO,CAACH,IAAR,GAAe,IAAf;AACA,SAAOG,OAAP;AACH,CALD;;AAOAhB,OAAO,CAACmB,SAAR,GAAoB,UAAUC,KAAV,EAAiBC,OAAjB,EAA0B;AAC1C,MAAIL,OAAO,GAAG,IAAIhB,OAAJ,EAAd;AACAgB,EAAAA,OAAO,CAACP,IAAR,GAAeY,OAAO,CAACZ,IAAvB;AACAO,EAAAA,OAAO,CAACJ,IAAR,GAAeS,OAAO,CAACT,IAAvB;AACAI,EAAAA,OAAO,CAACH,IAAR,GAAeQ,OAAO,CAACR,IAAvB;AAEA,MAAIO,KAAK,CAACE,OAAN,CAAc,CAAC,OAAD,CAAd,CAAJ,EACI,OAAON,OAAP;AAEJI,EAAAA,KAAK,CAACG,gBAAN;AAEAH,EAAAA,KAAK,CAACG,gBAAN;AACAP,EAAAA,OAAO,CAACT,YAAR,CAAqBiB,IAArB,CAA0BC,KAA1B,CAAgCT,OAAO,CAACT,YAAxC,EAAsDa,KAAK,CAACM,gBAAN,CAAuBL,OAAvB,CAAtD;AACAD,EAAAA,KAAK,CAACO,cAAN;;AAEA,SAAOP,KAAK,CAACE,OAAN,CAAc,CAAC,GAAD,CAAd,CAAP,EAA6B;AACzBF,IAAAA,KAAK,CAACG,gBAAN;AACAP,IAAAA,OAAO,CAACR,aAAR,CAAsBgB,IAAtB,CAA2BJ,KAAK,CAACM,gBAAN,CAAuBL,OAAvB,CAA3B;AACAD,IAAAA,KAAK,CAACO,cAAN;AACH;;AAEDP,EAAAA,KAAK,CAACO,cAAN;AAEA,SAAOX,OAAP;AACH,CAxBD;;AA0BAhB,OAAO,CAAC4B,SAAR,GAAoB,UAAUR,KAAV,EAAiBC,OAAjB,EAA0B;AAC1C,MAAIL,OAAO,GAAG,IAAIhB,OAAJ,EAAd;AACAgB,EAAAA,OAAO,CAACP,IAAR,GAAeY,OAAO,CAACZ,IAAvB;AACAO,EAAAA,OAAO,CAACJ,IAAR,GAAeS,OAAO,CAACT,IAAvB;AACAI,EAAAA,OAAO,CAACH,IAAR,GAAeQ,OAAO,CAACR,IAAvB;AAEA,MAAIgB,SAAS,GAAGT,KAAK,CAACU,UAAN,EAAhB;;AAEA,MAAID,SAAS,GAAG,CAAhB,EAAmB;AACf,QAAIE,iBAAiB,GAAGX,KAAK,CAACU,UAAN,EAAxB;;AAEA,SAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,iBAApB,EAAuCC,CAAC,EAAxC,EACIhB,OAAO,CAACT,YAAR,CAAqBiB,IAArB,CAA0BnB,KAAK,CAAC4B,aAAN,CAAoBb,KAApB,EAA2BC,OAA3B,CAA1B;;AAEJ,SAAKW,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGH,SAAhB,EAA2BG,CAAC,EAA5B,EAAgC;AAC5B,UAAIE,YAAY,GAAG,EAAnB;AAEA,UAAIC,iBAAiB,GAAGf,KAAK,CAACU,UAAN,EAAxB;;AAEA,WAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,iBAApB,EAAuCC,CAAC,EAAxC,EACIF,YAAY,CAACV,IAAb,CAAkBnB,KAAK,CAAC4B,aAAN,CAAoBb,KAApB,EAA2BC,OAA3B,CAAlB;;AAEJL,MAAAA,OAAO,CAACR,aAAR,CAAsBgB,IAAtB,CAA2BU,YAA3B;AACH;AACJ;;AAED,SAAOlB,OAAP;AACH,CA3BD;;AA6BAhB,OAAO,CAACqC,UAAR,GAAqB,UAAUjB,KAAV,EAAiBC,OAAjB,EAA0B;AAC3C,MAAIL,OAAO,GAAG,IAAIhB,OAAJ,EAAd;AACAgB,EAAAA,OAAO,CAACJ,IAAR,GAAeS,OAAO,CAACT,IAAvB;AACAI,EAAAA,OAAO,CAACH,IAAR,GAAeQ,OAAO,CAACR,IAAvB;AAEA,MAAIQ,OAAO,CAACiB,OAAZ,EACI,OAAOtB,OAAP;AAEJ,MAAIuB,aAAa,GAAG,IAAIlC,KAAJ,CAAU,CAAV,EAAa,CAAb,EAAgBgB,OAAO,CAACT,IAAR,GAAe,CAAf,GAAmB4B,SAAnC,EAA8CnB,OAAO,CAACR,IAAR,GAAe,CAAf,GAAmB2B,SAAjE,CAApB;AACA,MAAIX,SAAS,GAAGT,KAAK,CAACqB,UAAN,EAAhB;AACA,MAAIV,iBAAiB,GAAGX,KAAK,CAACqB,UAAN,EAAxB;;AAEA,OAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,iBAApB,EAAuCC,CAAC,EAAxC,EACIhB,OAAO,CAACT,YAAR,CAAqBiB,IAArB,CAA0BnB,KAAK,CAACqC,cAAN,CAAqBtB,KAArB,EAA4BC,OAA5B,EAAqCkB,aAArC,CAA1B;;AAEJ,OAAKP,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGH,SAAhB,EAA2BG,CAAC,EAA5B,EAAgC;AAC5B,QAAIE,YAAY,GAAG,EAAnB;AAEA,QAAIC,iBAAiB,GAAGf,KAAK,CAACqB,UAAN,EAAxB;;AAEA,SAAK,IAAIL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,iBAApB,EAAuCC,CAAC,EAAxC,EACIF,YAAY,CAACV,IAAb,CAAkBnB,KAAK,CAACqC,cAAN,CAAqBtB,KAArB,EAA4BC,OAA5B,EAAqCkB,aAArC,CAAlB;;AAEJvB,IAAAA,OAAO,CAACR,aAAR,CAAsBgB,IAAtB,CAA2BU,YAA3B;AACH;;AAED,SAAOlB,OAAP;AACH,CA3BD;;AA6BAhB,OAAO,CAAC2C,aAAR,GAAwB,UAAUvB,KAAV,EAAiB;AACrC,MAAIJ,OAAO,GAAG,IAAIhB,OAAJ,EAAd;AAEA,MAAIoB,KAAK,CAACwB,WAAN,CAAkBjC,MAAlB,GAA2B,CAA3B,IAAgCS,KAAK,CAACwB,WAAN,CAAkB,CAAlB,EAAqBjC,MAArB,GAA8B,CAAlE,EACIK,OAAO,CAACJ,IAAR,GAAeQ,KAAK,CAACwB,WAAN,CAAkB,CAAlB,EAAqB,CAArB,EAAwBjC,MAAxB,GAAiC,CAAhD;;AAEJ,OAAK,IAAIqB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,KAAK,CAACwB,WAAN,CAAkBjC,MAAtC,EAA8CqB,CAAC,EAA/C,EAAmD;AAC/C,QAAIA,CAAC,GAAG,CAAR,EACIhB,OAAO,CAACR,aAAR,CAAsBgB,IAAtB,CAA2B,EAA3B;;AAEJ,SAAK,IAAIY,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAIhB,KAAK,CAACwB,WAAN,CAAkBZ,CAAlB,EAAqBrB,MAA1C,EAAkDyB,CAAC,EAAnD,EAAuD;AACnD,UAAIJ,CAAC,KAAK,CAAV,EACIhB,OAAO,CAACT,YAAR,CAAqBiB,IAArB,CAA0BnB,KAAK,CAACwC,iBAAN,CAAwBzB,KAAK,CAACwB,WAAN,CAAkBZ,CAAlB,EAAqBI,CAArB,CAAxB,CAA1B,EADJ,KAGIpB,OAAO,CAACR,aAAR,CAAsBwB,CAAC,GAAG,CAA1B,EAA6BR,IAA7B,CAAkCnB,KAAK,CAACwC,iBAAN,CAAwBzB,KAAK,CAACwB,WAAN,CAAkBZ,CAAlB,EAAqBI,CAArB,CAAxB,CAAlC;AACP;AACJ;;AAED,SAAOpB,OAAP;AACH,CAnBD;;AAqBAhB,OAAO,CAAC8C,SAAR,CAAkBC,KAAlB,GAA0B,YAAY;AAClC,MAAI,KAAKxC,YAAL,CAAkBI,MAAlB,KAA6B,CAAjC,EACI,OAAO,KAAKqC,WAAL,CAAiB5C,KAAK,CAAC6C,GAAN,CAAUjD,OAA3B,EAAoC,IAApC,CAAP;AAEJ,SAAO,KAAKgD,WAAL,CAAiB5C,KAAK,CAAC6C,GAAN,CAAUjD,OAA3B,EAAoC,KAApC,IAA6C,KAAKkD,WAAL,EAApD;AACH,CALD;;AAOAlD,OAAO,CAAC8C,SAAR,CAAkBI,WAAlB,GAAgC,YAAY;AACxC,MAAIC,QAAQ,GAAG,IAAf;;AAEA,OAAK,IAAInB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,YAAL,CAAkBI,MAAtC,EAA8CqB,CAAC,EAA/C,EACImB,QAAQ,IAAI,KAAKC,iBAAL,CAAuB,KAAK7C,YAAL,CAAkByB,CAAlB,CAAvB,IAA+C,GAA3D;;AAEJmB,EAAAA,QAAQ,GAAGA,QAAQ,CAACE,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAX;AACAF,EAAAA,QAAQ,IAAI,GAAZ;;AAEA,OAAKnB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKxB,aAAL,CAAmBG,MAAnC,EAA2CqB,CAAC,EAA5C,EAAgD;AAC5CmB,IAAAA,QAAQ,IAAI,IAAZ;;AAEA,SAAK,IAAIf,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAA1C,EAAkDyB,CAAC,EAAnD,EAAuD;AACnDe,MAAAA,QAAQ,IAAI,KAAKC,iBAAL,CAAuB,KAAK5C,aAAL,CAAmBwB,CAAnB,EAAsBI,CAAtB,CAAvB,IAAmD,GAA/D;AACH;;AAEDe,IAAAA,QAAQ,GAAGA,QAAQ,CAACE,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAX;AACAF,IAAAA,QAAQ,IAAI,GAAZ;AACH;;AAEDA,EAAAA,QAAQ,IAAI,GAAZ;AAEA,SAAOA,QAAP;AACH,CAvBD;;AAyBAnD,OAAO,CAAC8C,SAAR,CAAkBQ,KAAlB,GAA0B,UAAUC,aAAV,EAAyB;AAC/C,MAAIC,GAAG,GAAG,IAAIlD,YAAJ,CAAiB,KAAKmD,WAAL,EAAjB,CAAV;AAEAD,EAAAA,GAAG,CAACE,SAAJ,CAAc,CAAd;;AAEA,OAAKC,aAAL,CAAmBH,GAAnB,EAAwBpD,KAAK,CAACoD,GAAN,CAAUxD,OAAlC,EAA2CuD,aAA3C;;AAEA,MAAI,KAAKhD,YAAL,CAAkBI,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B6C,IAAAA,GAAG,CAACI,aAAJ,CAAkB,IAAI,KAAKpD,aAAL,CAAmBG,MAAzC;AACA6C,IAAAA,GAAG,CAACI,aAAJ,CAAkB,KAAKrD,YAAL,CAAkBI,MAApC;AACH,GAHD,MAIK;AACD6C,IAAAA,GAAG,CAACI,aAAJ,CAAkB,CAAlB;AACH;;AAED,OAAK,IAAI5B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,YAAL,CAAkBI,MAAtC,EAA8CqB,CAAC,EAA/C,EACI,KAAKzB,YAAL,CAAkByB,CAAlB,EAAqB6B,cAArB,CAAoCL,GAApC;;AAEJ,OAAKxB,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKxB,aAAL,CAAmBG,MAAnC,EAA2CqB,CAAC,EAA5C,EAAgD;AAC5CwB,IAAAA,GAAG,CAACI,aAAJ,CAAkB,KAAKpD,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAAxC;;AAEA,SAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAA1C,EAAkDyB,CAAC,EAAnD,EACI,KAAK5B,aAAL,CAAmBwB,CAAnB,EAAsBI,CAAtB,EAAyByB,cAAzB,CAAwCL,GAAxC;AACP;;AAED,SAAOA,GAAG,CAACM,MAAX;AACH,CA1BD;;AA4BA9D,OAAO,CAAC8C,SAAR,CAAkBiB,MAAlB,GAA2B,YAAY;AACnC,MAAIC,IAAI,GAAG,IAAI1D,YAAJ,CAAiB,CAAjB,EAAoB,IAApB,CAAX;AAEA,MAAI2D,SAAS,GAAG9D,QAAQ,CAAC+D,gBAAT,CAA0B,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC,CAAhB;AACA,MAAI5B,OAAO,GAAG,KAAK/B,YAAL,CAAkBI,MAAlB,KAA6B,CAA3C;;AAEA,OAAKwD,gBAAL,CAAsBH,IAAtB,EAA4B5D,KAAK,CAACoD,GAAN,CAAUxD,OAAtC,EAA+CiE,SAA/C,EAA0D3B,OAA1D;;AAEA,MAAI,KAAK/B,YAAL,CAAkBI,MAAlB,GAA2B,CAA/B,EAAkC;AAC9BqD,IAAAA,IAAI,CAACI,WAAL,CAAiB,IAAI,KAAK5D,aAAL,CAAmBG,MAAxC;AAEAqD,IAAAA,IAAI,CAACI,WAAL,CAAiB,KAAK7D,YAAL,CAAkBI,MAAnC;AAEA,QAAI4B,aAAa,GAAG,IAAIlC,KAAJ,CAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,CAApB;;AACA,SAAK,IAAI2B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,YAAL,CAAkBI,MAAtC,EAA8CqB,CAAC,EAA/C,EACI,KAAKzB,YAAL,CAAkByB,CAAlB,EAAqBqC,eAArB,CAAqCL,IAArC,EAA2CC,SAA3C,EAAsD1B,aAAtD;;AAEJ,SAAKP,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAG,KAAKxB,aAAL,CAAmBG,MAAnC,EAA2CqB,CAAC,EAA5C,EAAgD;AAC5CgC,MAAAA,IAAI,CAACI,WAAL,CAAiB,KAAK5D,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAAvC;;AAEA,WAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAA1C,EAAkDyB,CAAC,EAAnD,EACI,KAAK5B,aAAL,CAAmBwB,CAAnB,EAAsBI,CAAtB,EAAyBiC,eAAzB,CAAyCL,IAAzC,EAA+CC,SAA/C,EAA0D1B,aAA1D;AACP;AACJ;;AAED,SAAOyB,IAAI,CAACF,MAAZ;AACH,CA1BD;;AA4BA9D,OAAO,CAAC8C,SAAR,CAAkBW,WAAlB,GAAgC,YAAY;AACxC,MAAIa,cAAc,GAAG,EAArB;AAEA,MAAI,KAAK1D,IAAT,EACI0D,cAAc,IAAI,CAAlB;AACJ,MAAI,KAAKzD,IAAT,EACIyD,cAAc,IAAI,CAAlB;AAEJ,MAAIC,IAAI,GAAG,IAAI,CAAJ,GAAQ,CAAnB;AAEA,MAAI,KAAKhE,YAAL,CAAkBI,MAAlB,GAA2B,CAA/B,EACI4D,IAAI,IAAI,IAAK,KAAKhE,YAAL,CAAkBI,MAAlB,GAA2B2D,cAAxC;;AAEJ,OAAK,IAAItC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKxB,aAAL,CAAmBG,MAAvC,EAA+CqB,CAAC,EAAhD,EACIuC,IAAI,IAAI,IAAK,KAAK/D,aAAL,CAAmBwB,CAAnB,EAAsBrB,MAAtB,GAA+B2D,cAA5C;;AAEJ,SAAOC,IAAP;AACH,CAjBD;;AAmBAvE,OAAO,CAAC8C,SAAR,CAAkB0B,SAAlB,GAA8B,UAAUnD,OAAV,EAAmB;AAC7C,MAAIoD,OAAO,GAAGtE,QAAQ,CAAC2C,SAAT,CAAmB0B,SAAnB,CAA6B9D,IAA7B,CAAkC,IAAlC,EAAwCW,OAAxC,CAAd;AACAoD,EAAAA,OAAO,CAACC,IAAR,GAAetE,KAAK,CAACqE,OAAN,CAAczE,OAA7B;AACAyE,EAAAA,OAAO,CAAC7B,WAAR,GAAsB,EAAtB;;AAEA,MAAI,KAAKrC,YAAL,CAAkBI,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B,QAAIJ,YAAY,GAAG,EAAnB;;AAEA,SAAK,IAAIyB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKzB,YAAL,CAAkBI,MAAtC,EAA8CqB,CAAC,EAA/C,EAAmD;AAC/C,UAAI,KAAKpB,IAAT,EACIL,YAAY,CAACiB,IAAb,CAAkB,CAAC,KAAKjB,YAAL,CAAkByB,CAAlB,EAAqB2C,CAAtB,EAAyB,KAAKpE,YAAL,CAAkByB,CAAlB,EAAqB4C,CAA9C,EAAiD,KAAKrE,YAAL,CAAkByB,CAAlB,EAAqB6C,CAAtE,CAAlB,EADJ,KAGItE,YAAY,CAACiB,IAAb,CAAkB,CAAC,KAAKjB,YAAL,CAAkByB,CAAlB,EAAqB2C,CAAtB,EAAyB,KAAKpE,YAAL,CAAkByB,CAAlB,EAAqB4C,CAA9C,CAAlB;AACP;;AAEDH,IAAAA,OAAO,CAAC7B,WAAR,CAAoBpB,IAApB,CAAyBjB,YAAzB;AACH;;AAED,OAAK,IAAI6B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,aAAL,CAAmBG,MAAvC,EAA+CyB,CAAC,EAAhD,EAAoD;AAChD,QAAIF,YAAY,GAAG,EAAnB;;AAEA,SAAK,IAAI4C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKtE,aAAL,CAAmB4B,CAAnB,EAAsBzB,MAA1C,EAAkDmE,CAAC,EAAnD,EAAuD;AACnD,UAAI,KAAKlE,IAAT,EACIsB,YAAY,CAACV,IAAb,CAAkB,CAAC,KAAKhB,aAAL,CAAmB4B,CAAnB,EAAsB0C,CAAtB,EAAyBH,CAA1B,EAA6B,KAAKnE,aAAL,CAAmB4B,CAAnB,EAAsB0C,CAAtB,EAAyBF,CAAtD,EAAyD,KAAKpE,aAAL,CAAmB4B,CAAnB,EAAsB0C,CAAtB,EAAyBD,CAAlF,CAAlB,EADJ,KAGI3C,YAAY,CAACV,IAAb,CAAkB,CAAC,KAAKhB,aAAL,CAAmB4B,CAAnB,EAAsB0C,CAAtB,EAAyBH,CAA1B,EAA6B,KAAKnE,aAAL,CAAmB4B,CAAnB,EAAsB0C,CAAtB,EAAyBF,CAAtD,CAAlB;AACP;;AAEDH,IAAAA,OAAO,CAAC7B,WAAR,CAAoBpB,IAApB,CAAyBU,YAAzB;AACH;;AAED,SAAOuC,OAAP;AACH,CAhCD","sourcesContent":["module.exports = Polygon;\r\n\r\nvar util = require('util');\r\n\r\nvar Geometry = require('./geometry');\r\nvar Types = require('./types');\r\nvar Point = require('./point');\r\nvar BinaryWriter = require('./binarywriter');\r\n\r\nfunction Polygon(exteriorRing, interiorRings, srid) {\r\n    Geometry.call(this);\r\n\r\n    this.exteriorRing = exteriorRing || [];\r\n    this.interiorRings = interiorRings || [];\r\n\tthis.srid = srid;\r\n\r\n    if (this.exteriorRing.length > 0) {\r\n        this.hasZ = this.exteriorRing[0].hasZ;\r\n        this.hasM = this.exteriorRing[0].hasM;\r\n    }\r\n}\r\n\r\nutil.inherits(Polygon, Geometry);\r\n\r\nPolygon.Z = function (exteriorRing, interiorRings, srid) {\r\n    var polygon = new Polygon(exteriorRing, interiorRings, srid);\r\n    polygon.hasZ = true;\r\n    return polygon;\r\n};\r\n\r\nPolygon.M = function (exteriorRing, interiorRings, srid) {\r\n    var polygon = new Polygon(exteriorRing, interiorRings, srid);\r\n    polygon.hasM = true;\r\n    return polygon;\r\n};\r\n\r\nPolygon.ZM = function (exteriorRing, interiorRings, srid) {\r\n    var polygon = new Polygon(exteriorRing, interiorRings, srid);\r\n    polygon.hasZ = true;\r\n    polygon.hasM = true;\r\n    return polygon;\r\n};\r\n\r\nPolygon._parseWkt = function (value, options) {\r\n    var polygon = new Polygon();\r\n    polygon.srid = options.srid;\r\n    polygon.hasZ = options.hasZ;\r\n    polygon.hasM = options.hasM;\r\n\r\n    if (value.isMatch(['EMPTY']))\r\n        return polygon;\r\n\r\n    value.expectGroupStart();\r\n\r\n    value.expectGroupStart();\r\n    polygon.exteriorRing.push.apply(polygon.exteriorRing, value.matchCoordinates(options));\r\n    value.expectGroupEnd();\r\n\r\n    while (value.isMatch([','])) {\r\n        value.expectGroupStart();\r\n        polygon.interiorRings.push(value.matchCoordinates(options));\r\n        value.expectGroupEnd();\r\n    }\r\n\r\n    value.expectGroupEnd();\r\n\r\n    return polygon;\r\n};\r\n\r\nPolygon._parseWkb = function (value, options) {\r\n    var polygon = new Polygon();\r\n    polygon.srid = options.srid;\r\n    polygon.hasZ = options.hasZ;\r\n    polygon.hasM = options.hasM;\r\n\r\n    var ringCount = value.readUInt32();\r\n\r\n    if (ringCount > 0) {\r\n        var exteriorRingCount = value.readUInt32();\r\n\r\n        for (var i = 0; i < exteriorRingCount; i++)\r\n            polygon.exteriorRing.push(Point._readWkbPoint(value, options));\r\n\r\n        for (i = 1; i < ringCount; i++) {\r\n            var interiorRing = [];\r\n\r\n            var interiorRingCount = value.readUInt32();\r\n\r\n            for (var j = 0; j < interiorRingCount; j++)\r\n                interiorRing.push(Point._readWkbPoint(value, options));\r\n\r\n            polygon.interiorRings.push(interiorRing);\r\n        }\r\n    }\r\n\r\n    return polygon;\r\n};\r\n\r\nPolygon._parseTwkb = function (value, options) {\r\n    var polygon = new Polygon();\r\n    polygon.hasZ = options.hasZ;\r\n    polygon.hasM = options.hasM;\r\n\r\n    if (options.isEmpty)\r\n        return polygon;\r\n\r\n    var previousPoint = new Point(0, 0, options.hasZ ? 0 : undefined, options.hasM ? 0 : undefined);\r\n    var ringCount = value.readVarInt();\r\n    var exteriorRingCount = value.readVarInt();\r\n\r\n    for (var i = 0; i < exteriorRingCount; i++)\r\n        polygon.exteriorRing.push(Point._readTwkbPoint(value, options, previousPoint));\r\n\r\n    for (i = 1; i < ringCount; i++) {\r\n        var interiorRing = [];\r\n\r\n        var interiorRingCount = value.readVarInt();\r\n\r\n        for (var j = 0; j < interiorRingCount; j++)\r\n            interiorRing.push(Point._readTwkbPoint(value, options, previousPoint));\r\n\r\n        polygon.interiorRings.push(interiorRing);\r\n    }\r\n\r\n    return polygon;\r\n};\r\n\r\nPolygon._parseGeoJSON = function (value) {\r\n    var polygon = new Polygon();\r\n\r\n    if (value.coordinates.length > 0 && value.coordinates[0].length > 0)\r\n        polygon.hasZ = value.coordinates[0][0].length > 2;\r\n\r\n    for (var i = 0; i < value.coordinates.length; i++) {\r\n        if (i > 0)\r\n            polygon.interiorRings.push([]);\r\n\r\n        for (var j = 0; j  < value.coordinates[i].length; j++) {\r\n            if (i === 0)\r\n                polygon.exteriorRing.push(Point._readGeoJSONPoint(value.coordinates[i][j]));\r\n            else\r\n                polygon.interiorRings[i - 1].push(Point._readGeoJSONPoint(value.coordinates[i][j]));\r\n        }\r\n    }\r\n\r\n    return polygon;\r\n};\r\n\r\nPolygon.prototype.toWkt = function () {\r\n    if (this.exteriorRing.length === 0)\r\n        return this._getWktType(Types.wkt.Polygon, true);\r\n\r\n    return this._getWktType(Types.wkt.Polygon, false) + this._toInnerWkt();\r\n};\r\n\r\nPolygon.prototype._toInnerWkt = function () {\r\n    var innerWkt = '((';\r\n\r\n    for (var i = 0; i < this.exteriorRing.length; i++)\r\n        innerWkt += this._getWktCoordinate(this.exteriorRing[i]) + ',';\r\n\r\n    innerWkt = innerWkt.slice(0, -1);\r\n    innerWkt += ')';\r\n\r\n    for (i = 0; i < this.interiorRings.length; i++) {\r\n        innerWkt += ',(';\r\n\r\n        for (var j = 0; j < this.interiorRings[i].length; j++) {\r\n            innerWkt += this._getWktCoordinate(this.interiorRings[i][j]) + ',';\r\n        }\r\n\r\n        innerWkt = innerWkt.slice(0, -1);\r\n        innerWkt += ')';\r\n    }\r\n\r\n    innerWkt += ')';\r\n\r\n    return innerWkt;\r\n};\r\n\r\nPolygon.prototype.toWkb = function (parentOptions) {\r\n    var wkb = new BinaryWriter(this._getWkbSize());\r\n\r\n    wkb.writeInt8(1);\r\n\r\n    this._writeWkbType(wkb, Types.wkb.Polygon, parentOptions);\r\n\r\n    if (this.exteriorRing.length > 0) {\r\n        wkb.writeUInt32LE(1 + this.interiorRings.length);\r\n        wkb.writeUInt32LE(this.exteriorRing.length);\r\n    }\r\n    else {\r\n        wkb.writeUInt32LE(0);\r\n    }\r\n\r\n    for (var i = 0; i < this.exteriorRing.length; i++)\r\n        this.exteriorRing[i]._writeWkbPoint(wkb);\r\n\r\n    for (i = 0; i < this.interiorRings.length; i++) {\r\n        wkb.writeUInt32LE(this.interiorRings[i].length);\r\n\r\n        for (var j = 0; j < this.interiorRings[i].length; j++)\r\n            this.interiorRings[i][j]._writeWkbPoint(wkb);\r\n    }\r\n\r\n    return wkb.buffer;\r\n};\r\n\r\nPolygon.prototype.toTwkb = function () {\r\n    var twkb = new BinaryWriter(0, true);\r\n\r\n    var precision = Geometry.getTwkbPrecision(5, 0, 0);\r\n    var isEmpty = this.exteriorRing.length === 0;\r\n\r\n    this._writeTwkbHeader(twkb, Types.wkb.Polygon, precision, isEmpty);\r\n\r\n    if (this.exteriorRing.length > 0) {\r\n        twkb.writeVarInt(1 + this.interiorRings.length);\r\n\r\n        twkb.writeVarInt(this.exteriorRing.length);\r\n\r\n        var previousPoint = new Point(0, 0, 0, 0);\r\n        for (var i = 0; i < this.exteriorRing.length; i++)\r\n            this.exteriorRing[i]._writeTwkbPoint(twkb, precision, previousPoint);\r\n\r\n        for (i = 0; i < this.interiorRings.length; i++) {\r\n            twkb.writeVarInt(this.interiorRings[i].length);\r\n\r\n            for (var j = 0; j < this.interiorRings[i].length; j++)\r\n                this.interiorRings[i][j]._writeTwkbPoint(twkb, precision, previousPoint);\r\n        }\r\n    }\r\n\r\n    return twkb.buffer;\r\n};\r\n\r\nPolygon.prototype._getWkbSize = function () {\r\n    var coordinateSize = 16;\r\n\r\n    if (this.hasZ)\r\n        coordinateSize += 8;\r\n    if (this.hasM)\r\n        coordinateSize += 8;\r\n\r\n    var size = 1 + 4 + 4;\r\n\r\n    if (this.exteriorRing.length > 0)\r\n        size += 4 + (this.exteriorRing.length * coordinateSize);\r\n\r\n    for (var i = 0; i < this.interiorRings.length; i++)\r\n        size += 4 + (this.interiorRings[i].length * coordinateSize);\r\n\r\n    return size;\r\n};\r\n\r\nPolygon.prototype.toGeoJSON = function (options) {\r\n    var geoJSON = Geometry.prototype.toGeoJSON.call(this, options);\r\n    geoJSON.type = Types.geoJSON.Polygon;\r\n    geoJSON.coordinates = [];\r\n\r\n    if (this.exteriorRing.length > 0) {\r\n        var exteriorRing = [];\r\n\r\n        for (var i = 0; i < this.exteriorRing.length; i++) {\r\n            if (this.hasZ)\r\n                exteriorRing.push([this.exteriorRing[i].x, this.exteriorRing[i].y, this.exteriorRing[i].z]);\r\n            else\r\n                exteriorRing.push([this.exteriorRing[i].x, this.exteriorRing[i].y]);\r\n        }\r\n\r\n        geoJSON.coordinates.push(exteriorRing);\r\n    }\r\n\r\n    for (var j = 0; j < this.interiorRings.length; j++) {\r\n        var interiorRing = [];\r\n\r\n        for (var k = 0; k < this.interiorRings[j].length; k++) {\r\n            if (this.hasZ)\r\n                interiorRing.push([this.interiorRings[j][k].x, this.interiorRings[j][k].y, this.interiorRings[j][k].z]);\r\n            else\r\n                interiorRing.push([this.interiorRings[j][k].x, this.interiorRings[j][k].y]);\r\n        }\r\n\r\n        geoJSON.coordinates.push(interiorRing);\r\n    }\r\n\r\n    return geoJSON;\r\n};\r\n"]},"metadata":{},"sourceType":"script"}