{"ast":null,"code":"/*\r\n * @copyright\r\n * Copyright © Microsoft Open Technologies, Inc.\r\n *\r\n * All Rights Reserved\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http: *www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS\r\n * OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION\r\n * ANY IMPLIED WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A\r\n * PARTICULAR PURPOSE, MERCHANTABILITY OR NON-INFRINGEMENT.\r\n *\r\n * See the Apache License, Version 2.0 for the specific language\r\n * governing permissions and limitations under the License.\r\n */\n'use strict';\n\nvar jwtConstants = require('./constants').Jwt;\n\nvar Logger = require('./log').Logger;\n\nvar util = require('./util');\n\nrequire('date-utils');\n\nvar jws = require('jws');\n\nvar uuid = require('uuid');\n/**\r\n * JavaScript dates are in milliseconds, but JWT dates are in seconds.\r\n * This function does the conversion.\r\n * @param  {Date}   date\r\n * @return {string}\r\n */\n\n\nfunction dateGetTimeInSeconds(date) {\n  return Math.floor(date.getTime() / 1000);\n}\n/**\r\n * Constructs a new SelfSignedJwt object.\r\n * @param {object}    callContext    Context specific to this token request.\r\n * @param {Authority} authority      The authority to be used as the JWT audience.\r\n * @param {string}    clientId       The client id of the calling app.\r\n */\n\n\nfunction SelfSignedJwt(callContext, authority, clientId) {\n  this._log = new Logger('SelfSignedJwt', callContext._logContext);\n  this._callContext = callContext;\n  this._authority = authority;\n  this._tokenEndpoint = authority.tokenEndpoint;\n  this._clientId = clientId;\n}\n/**\r\n * This wraps date creation in order to make unit testing easier.\r\n * @return {Date}\r\n */\n\n\nSelfSignedJwt.prototype._getDateNow = function () {\n  return new Date();\n};\n\nSelfSignedJwt.prototype._getNewJwtId = function () {\n  return uuid.v4();\n};\n/**\r\n * A regular certificate thumbprint is a hex encode string of the binary certificate\r\n * hash.  For some reason teh x5t value in a JWT is a url save base64 encoded string\r\n * instead.  This function does the conversion.\r\n * @param  {string} thumbprint  A hex encoded certificate thumbprint.\r\n * @return {string} A url safe base64 encoded certificate thumbprint.\r\n */\n\n\nSelfSignedJwt.prototype._createx5tValue = function (thumbprint) {\n  var hexString = thumbprint.replace(/:/g, '').replace(/ /g, '');\n  var base64 = new Buffer(hexString, 'hex').toString('base64');\n  return util.convertRegularToUrlSafeBase64EncodedString(base64);\n};\n/**\r\n * Creates the JWT header.\r\n * @param  {string} thumbprint  A hex encoded certificate thumbprint.\r\n * @return {object}\r\n */\n\n\nSelfSignedJwt.prototype._createHeader = function (thumbprint) {\n  var x5t = this._createx5tValue(thumbprint);\n\n  var header = {\n    typ: 'JWT',\n    alg: 'RS256',\n    x5t: x5t\n  };\n\n  this._log.verbose('Creating self signed JWT header');\n\n  this._log.verbose('Creating self signed JWT header.  x5t: ' + x5t, true);\n\n  return header;\n};\n/**\r\n * Creates the JWT payload.\r\n * @return {object}\r\n */\n\n\nSelfSignedJwt.prototype._createPayload = function () {\n  var now = this._getDateNow();\n\n  var expires = new Date(now.getTime()).addMinutes(jwtConstants.SELF_SIGNED_JWT_LIFETIME);\n\n  this._log.verbose('Creating self signed JWT payload.  Expires: ' + expires + ' NotBefore: ' + now);\n\n  var jwtPayload = {};\n  jwtPayload[jwtConstants.AUDIENCE] = this._tokenEndpoint;\n  jwtPayload[jwtConstants.ISSUER] = this._clientId;\n  jwtPayload[jwtConstants.SUBJECT] = this._clientId;\n  jwtPayload[jwtConstants.NOT_BEFORE] = dateGetTimeInSeconds(now);\n  jwtPayload[jwtConstants.EXPIRES_ON] = dateGetTimeInSeconds(expires);\n  jwtPayload[jwtConstants.JWT_ID] = this._getNewJwtId();\n  return jwtPayload;\n};\n\nSelfSignedJwt.prototype._throwOnInvalidJwtSignature = function (jwt) {\n  var jwtSegments = jwt.split('.');\n\n  if (3 > jwtSegments.length || !jwtSegments[2]) {\n    throw this._log.createError('Failed to sign JWT.  This is most likely due to an invalid certificate.');\n  }\n\n  return;\n};\n\nSelfSignedJwt.prototype._signJwt = function (header, payload, certificate) {\n  var jwt;\n\n  try {\n    jwt = jws.sign({\n      header: header,\n      payload: payload,\n      secret: certificate\n    });\n  } catch (err) {\n    this._log.error(err, true);\n\n    throw this._log.createError('Failed to sign JWT.This is most likely due to an invalid certificate.');\n  }\n\n  this._throwOnInvalidJwtSignature(jwt);\n\n  return jwt;\n};\n\nSelfSignedJwt.prototype._reduceThumbprint = function (thumbprint) {\n  var canonical = thumbprint.toLowerCase().replace(/ /g, '').replace(/:/g, '');\n\n  this._throwOnInvalidThumbprint(canonical);\n\n  return canonical;\n};\n\nvar numCharIn128BitHexString = 128 / 8 * 2;\nvar numCharIn160BitHexString = 160 / 8 * 2;\nvar thumbprintSizes = {};\nthumbprintSizes[numCharIn128BitHexString] = true;\nthumbprintSizes[numCharIn160BitHexString] = true;\nvar thumbprintRegExp = /^[a-f\\d]*$/;\n\nSelfSignedJwt.prototype._throwOnInvalidThumbprint = function (thumbprint) {\n  if (!thumbprintSizes[thumbprint.length] || !thumbprintRegExp.test(thumbprint)) {\n    throw this._log.createError('The thumbprint does not match a known format');\n  }\n};\n/**\r\n * Creates a self signed JWT that can be used as a client_assertion.\r\n * @param  {string}  certificate   A PEM encoded certificate private key.\r\n * @param  {string}  thumbprint    A hex encoded thumbprint of the certificate.\r\n * @return {string}  A self signed JWT token.\r\n */\n\n\nSelfSignedJwt.prototype.create = function (certificate, thumbprint) {\n  thumbprint = this._reduceThumbprint(thumbprint);\n\n  var header = this._createHeader(thumbprint);\n\n  var payload = this._createPayload();\n\n  var jwt = this._signJwt(header, payload, certificate);\n\n  return jwt;\n};\n\nmodule.exports = SelfSignedJwt;","map":{"version":3,"sources":["/Users/ryandavis/Development/reactapp/expresstimes/node_modules/adal-node/lib/self-signed-jwt.js"],"names":["jwtConstants","require","Jwt","Logger","util","jws","uuid","dateGetTimeInSeconds","date","Math","floor","getTime","SelfSignedJwt","callContext","authority","clientId","_log","_logContext","_callContext","_authority","_tokenEndpoint","tokenEndpoint","_clientId","prototype","_getDateNow","Date","_getNewJwtId","v4","_createx5tValue","thumbprint","hexString","replace","base64","Buffer","toString","convertRegularToUrlSafeBase64EncodedString","_createHeader","x5t","header","typ","alg","verbose","_createPayload","now","expires","addMinutes","SELF_SIGNED_JWT_LIFETIME","jwtPayload","AUDIENCE","ISSUER","SUBJECT","NOT_BEFORE","EXPIRES_ON","JWT_ID","_throwOnInvalidJwtSignature","jwt","jwtSegments","split","length","createError","_signJwt","payload","certificate","sign","secret","err","error","_reduceThumbprint","canonical","toLowerCase","_throwOnInvalidThumbprint","numCharIn128BitHexString","numCharIn160BitHexString","thumbprintSizes","thumbprintRegExp","test","create","module","exports"],"mappings":"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","sourcesContent":["/*\r\n * @copyright\r\n * Copyright © Microsoft Open Technologies, Inc.\r\n *\r\n * All Rights Reserved\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n * http: *www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS\r\n * OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION\r\n * ANY IMPLIED WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A\r\n * PARTICULAR PURPOSE, MERCHANTABILITY OR NON-INFRINGEMENT.\r\n *\r\n * See the Apache License, Version 2.0 for the specific language\r\n * governing permissions and limitations under the License.\r\n */\r\n'use strict';\r\n\r\nvar jwtConstants = require('./constants').Jwt;\r\nvar Logger = require('./log').Logger;\r\nvar util = require('./util');\r\n\r\nrequire('date-utils');\r\nvar jws = require('jws');\r\nvar uuid = require('uuid');\r\n\r\n/**\r\n * JavaScript dates are in milliseconds, but JWT dates are in seconds.\r\n * This function does the conversion.\r\n * @param  {Date}   date\r\n * @return {string}\r\n */\r\nfunction dateGetTimeInSeconds(date) {\r\n  return Math.floor(date.getTime()/1000);\r\n}\r\n\r\n/**\r\n * Constructs a new SelfSignedJwt object.\r\n * @param {object}    callContext    Context specific to this token request.\r\n * @param {Authority} authority      The authority to be used as the JWT audience.\r\n * @param {string}    clientId       The client id of the calling app.\r\n */\r\nfunction SelfSignedJwt(callContext, authority, clientId) {\r\n  this._log = new Logger('SelfSignedJwt', callContext._logContext);\r\n  this._callContext = callContext;\r\n\r\n  this._authority = authority;\r\n  this._tokenEndpoint = authority.tokenEndpoint;\r\n  this._clientId = clientId;\r\n}\r\n\r\n/**\r\n * This wraps date creation in order to make unit testing easier.\r\n * @return {Date}\r\n */\r\nSelfSignedJwt.prototype._getDateNow = function() {\r\n  return new Date();\r\n};\r\n\r\nSelfSignedJwt.prototype._getNewJwtId = function() {\r\n  return uuid.v4();\r\n};\r\n\r\n/**\r\n * A regular certificate thumbprint is a hex encode string of the binary certificate\r\n * hash.  For some reason teh x5t value in a JWT is a url save base64 encoded string\r\n * instead.  This function does the conversion.\r\n * @param  {string} thumbprint  A hex encoded certificate thumbprint.\r\n * @return {string} A url safe base64 encoded certificate thumbprint.\r\n */\r\nSelfSignedJwt.prototype._createx5tValue = function(thumbprint) {\r\n    var hexString = thumbprint.replace(/:/g, '').replace(/ /g, '');\r\n    var base64 = (new Buffer(hexString, 'hex')).toString('base64');\r\n    return util.convertRegularToUrlSafeBase64EncodedString(base64);\r\n};\r\n\r\n/**\r\n * Creates the JWT header.\r\n * @param  {string} thumbprint  A hex encoded certificate thumbprint.\r\n * @return {object}\r\n */\r\nSelfSignedJwt.prototype._createHeader = function(thumbprint) {\r\n  var x5t = this._createx5tValue(thumbprint);\r\n  var header = { typ: 'JWT', alg: 'RS256', x5t : x5t };\r\n\r\n  this._log.verbose('Creating self signed JWT header');\r\n  this._log.verbose('Creating self signed JWT header.  x5t: ' + x5t, true);\r\n\r\n  return header;\r\n};\r\n\r\n/**\r\n * Creates the JWT payload.\r\n * @return {object}\r\n */\r\nSelfSignedJwt.prototype._createPayload = function() {\r\n  var now = this._getDateNow();\r\n  var expires = (new Date(now.getTime())).addMinutes(jwtConstants.SELF_SIGNED_JWT_LIFETIME);\r\n\r\n  this._log.verbose('Creating self signed JWT payload.  Expires: ' + expires + ' NotBefore: ' + now);\r\n\r\n  var jwtPayload = {};\r\n  jwtPayload[jwtConstants.AUDIENCE] = this._tokenEndpoint;\r\n  jwtPayload[jwtConstants.ISSUER] = this._clientId;\r\n  jwtPayload[jwtConstants.SUBJECT] = this._clientId;\r\n  jwtPayload[jwtConstants.NOT_BEFORE] = dateGetTimeInSeconds(now);\r\n  jwtPayload[jwtConstants.EXPIRES_ON] = dateGetTimeInSeconds(expires);\r\n  jwtPayload[jwtConstants.JWT_ID] = this._getNewJwtId();\r\n\r\n  return jwtPayload;\r\n};\r\n\r\nSelfSignedJwt.prototype._throwOnInvalidJwtSignature = function(jwt) {\r\n  var jwtSegments = jwt.split('.');\r\n\r\n  if (3 > jwtSegments.length || !jwtSegments[2]) {\r\n    throw this._log.createError('Failed to sign JWT.  This is most likely due to an invalid certificate.');\r\n  }\r\n\r\n  return;\r\n};\r\n\r\nSelfSignedJwt.prototype._signJwt = function(header, payload, certificate) {\r\n  var jwt;\r\n  try {\r\n     jwt = jws.sign({ header : header, payload : payload, secret : certificate });\r\n  }\r\n  catch (err) {\r\n     this._log.error(err, true);\r\n     throw this._log.createError('Failed to sign JWT.This is most likely due to an invalid certificate.');   \r\n  }\r\n  \r\n  this._throwOnInvalidJwtSignature(jwt);\r\n  return jwt;\r\n};\r\n\r\nSelfSignedJwt.prototype._reduceThumbprint = function(thumbprint) {\r\n    var canonical = thumbprint.toLowerCase().replace(/ /g, '').replace(/:/g, '');\r\n    this._throwOnInvalidThumbprint(canonical);\r\n    return canonical;\r\n};\r\n\r\nvar numCharIn128BitHexString = 128/8*2;\r\nvar numCharIn160BitHexString = 160/8*2;\r\nvar thumbprintSizes  = {};\r\nthumbprintSizes[numCharIn128BitHexString] = true;\r\nthumbprintSizes[numCharIn160BitHexString] = true;\r\nvar thumbprintRegExp = /^[a-f\\d]*$/;\r\n\r\nSelfSignedJwt.prototype._throwOnInvalidThumbprint = function(thumbprint) {\r\n  if (!thumbprintSizes[thumbprint.length] || !thumbprintRegExp.test(thumbprint)) {\r\n    throw this._log.createError('The thumbprint does not match a known format');\r\n  }\r\n};\r\n\r\n/**\r\n * Creates a self signed JWT that can be used as a client_assertion.\r\n * @param  {string}  certificate   A PEM encoded certificate private key.\r\n * @param  {string}  thumbprint    A hex encoded thumbprint of the certificate.\r\n * @return {string}  A self signed JWT token.\r\n */\r\nSelfSignedJwt.prototype.create = function(certificate, thumbprint) {\r\n  thumbprint = this._reduceThumbprint(thumbprint);\r\n  var header = this._createHeader(thumbprint);\r\n\r\n  var payload = this._createPayload();\r\n\r\n  var jwt = this._signJwt(header, payload, certificate);\r\n  return jwt;\r\n};\r\n\r\nmodule.exports = SelfSignedJwt;"]},"metadata":{},"sourceType":"script"}